<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pakistan Legal AI | Plain Text Edition</title>
    <style>
        /* CSS remains exactly the same as per your design */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root { --legal-green: #004d40; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; }
        header { background-color: var(--legal-green); width: 100%; height: 70px; display: flex; justify-content: center; position: sticky; top: 0; z-index: 9999; }
        .nav-container { width: 100%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { color: var(--white); font-size: 1.4rem; font-weight: bold; text-decoration: none; }
        .nav-list { display: flex; list-style: none; }
        .dropdown { position: relative; }
        .dropdown > a { color: var(--white); text-decoration: none; font-weight: 600; padding: 25px 15px; display: block; cursor: pointer; }
        .submenu { display: none; position: absolute; top: 70px; left: 0; background: white; width: 250px; box-shadow: 0 8px 16px rgba(0,0,0,0.15); list-style: none; border-radius: 0 0 5px 5px; }
        .submenu li a { color: #333; padding: 12px 15px; display: block; text-decoration: none; border-bottom: 1px solid #eee; font-size: 0.85rem; }
        .submenu li a:hover { background: #f1f1f1; color: var(--legal-green); font-weight: bold; }
        .dropdown:hover .submenu { display: block; }
        main { width: 100%; max-width: 900px; padding: 40px 20px; text-align: center; }
        .box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: left; }
        .expert-label { background: var(--legal-green); color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 15px; display: inline-block; }
        textarea { width: 100%; height: 150px; margin: 10px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
        button { background: var(--legal-green); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        #output { background: #ffffff; border: 1px solid #ddd; padding: 40px; min-height: 400px; white-space: pre-wrap; margin-top: 20px; font-family: 'Times New Roman', Times, serif; font-size: 12pt; line-height: 1.5; color: #000; }
        footer { margin-top: 40px; padding: 20px; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <a href="#" class="logo">⚖️ PakLegal AI</a>
        <ul class="nav-list">
            <li class="dropdown">
                <a>Criminal Law ▾</a>
                <ul class="submenu">
                    <li><a onclick="setMode('bail')">Bail Application (497/498)</a></li>
                    <li><a onclick="setMode('quash')">FIR Quashment (561-A)</a></li>
                    <li><a onclick="setMode('court_app')">Application to Court</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a>Civil Law ▾</a>
                <ul class="submenu">
                    <li><a onclick="setMode('prop')">Property Suit</a></li>
                    <li><a onclick="setMode('money')">Money Recovery</a></li>
                    <li><a onclick="setMode('contract')">Contracts/Agreements</a></li>
                    <li><a onclick="setMode('affidavit')">Affidavits</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a>Cyber Law ▾</a>
                <ul class="submenu">
                    <li><a onclick="setMode('cyber_def')">Cyber Defamation</a></li>
                    <li><a onclick="setMode('cyber_crime')">Cyber Crimes</a></li>
                    <li><a onclick="setMode('cyber_bail')">Cyber Bail</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a>Services ▾</a>
                <ul class="submenu">
                    <li><a onclick="setMode('writ')">Service Writ Petition</a></li>
                    <li><a onclick="setMode('show_cause')">Reply to Show Cause</a></li>
                </ul>
            </li>
        </ul>
    </div>
</header>

<main>
    <div class="box">
        <div id="expert-mode" class="expert-label">MODE: GENERAL LEGAL ASSISTANT</div>
        <textarea id="facts" placeholder="Choose a category from the menu above..."></textarea>
        <button onclick="generateDraft()">Generate Plain Text Draft</button>
        <button onclick="copyText()" style="background:#444;">Copy to Clipboard</button>
        <div id="status" style="margin-top:10px; font-weight:bold; text-align:center;"></div>
        <div id="output">Formal draft will appear here in Plain Text...</div>
    </div>
    <footer>&copy; 2026 legal.emahar.com</footer>
</main>

<script>
    let specializedPrompt = "You are a senior Pakistani lawyer.";
    const NO_MARKDOWN = " CRITICAL RULES: 1. Output MUST be PLAIN TEXT only. 2. NEVER use asterisks (**), hashes (#), or symbols. 3. Use CAPS for headings. 4. NEVER use the word 'Sheweth'; use 'Respectfully Submitted'.";

    function setMode(type) {
        const label = document.getElementById('expert-mode');
        const area = document.getElementById('facts');
        switch(type) {
            case 'bail': specializedPrompt = "Expert Criminal Advocate. Draft a Bail Application under 497/498 CrPC." + NO_MARKDOWN; label.innerText = "MODE: CRIMINAL (BAIL)"; area.placeholder = "Enter FIR details..."; break;
            case 'quash': specializedPrompt = "Expert Criminal Advocate. Draft FIR Quashment Petition under 561-A CrPC." + NO_MARKDOWN; label.innerText = "MODE: FIR QUASHMENT"; break;
            case 'prop': specializedPrompt = "Expert Civil Advocate. Draft a Suit for Property/Injunction." + NO_MARKDOWN; label.innerText = "MODE: CIVIL (PROPERTY)"; break;
            default: specializedPrompt = "Senior Pakistani Advocate. Draft formal court document." + NO_MARKDOWN; label.innerText = "MODE: GENERAL LEGAL";
        }
        alert("Active Expert: " + label.innerText);
    }

    async function generateDraft() {
        const facts = document.getElementById('facts').value;
        const outputDiv = document.getElementById('output');
        const statusDiv = document.getElementById('status');
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwSyhi6nK80NmQ38fy9xntQn-uHYUbuBINDGmqjmS_SUvHdcpP3fsSCkNAqLEIaSfiUvg/exec";

        if (!facts) return alert("Please enter facts!");
        statusDiv.innerHTML = "<span style='color:blue;'>⏳ Server is drafting (Gemini Secure Mode)...</span>";

        try {
            const response = await fetch(GAS_URL, {
                method: "POST",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify({
                    facts: facts,
                    prompt: specializedPrompt
                })
            });

            const result = await response.json();
            
            // LOGIC FOR GOOGLE GEMINI RESPONSE STRUCTURE
            if (result.candidates && result.candidates[0] && result.candidates[0].content) {
                let rawText = result.candidates[0].content.parts[0].text;
                
                // Extra safety: Remove any markdown characters that AI might include
                let cleanText = rawText.replace(/\*/g, '').replace(/#/g, '').replace(/_/g, '');
                
                outputDiv.innerText = cleanText;
                statusDiv.innerHTML = "<span style='color:green;'>✅ Draft Complete</span>";
            } else if (result.error) {
                statusDiv.innerHTML = "<span style='color:red;'>❌ AI Error: " + result.error.message + "</span>";
            } else {
                statusDiv.innerHTML = "<span style='color:red;'>❌ Unexpected Response Format.</span>";
                console.log("Full Response:", result);
            }
        } catch (err) {
            console.error("Fetch Error:", err);
            statusDiv.innerHTML = "<span style='color:red;'>❌ Connection Failed. Check GAS deployment.</span>";
        }
    }

    function copyText() {
        const text = document.getElementById('output').innerText;
        navigator.clipboard.writeText(text);
        alert("Copied to clipboard!");
    }
</script>
</body>
</html>
